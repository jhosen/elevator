\hypertarget{elev_8c}{\section{drivers/elev.c File Reference}
\label{elev_8c}\index{drivers/elev.\-c@{drivers/elev.\-c}}
}
{\ttfamily \#include $<$assert.\-h$>$}\\*
{\ttfamily \#include $<$stdio.\-h$>$}\\*
{\ttfamily \#include $<$stdlib.\-h$>$}\\*
{\ttfamily \#include $<$string.\-h$>$}\\*
{\ttfamily \#include $<$unistd.\-h$>$}\\*
{\ttfamily \#include $<$pthread.\-h$>$}\\*
{\ttfamily \#include \char`\"{}channels.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}elev.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}io.\-h\char`\"{}}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{elev_8c_a78c99ffd76a7bb3c8c74db76207e9ab4}{\-\_\-\-X\-O\-P\-E\-N\-\_\-\-S\-O\-U\-R\-C\-E}~500
\item 
\#define \hyperlink{elev_8c_a51f1b5dd58811d0028c967793a515699}{P\-O\-L\-L\-I\-N\-G\-\_\-\-I\-N\-T\-E\-R\-V\-A\-L}~50000
\item 
\#define \hyperlink{elev_8c_aea0d2ffe945c5b48aab391a3ac08309b}{N\-\_\-\-S\-I\-G\-N\-A\-L\-S}~6
\item 
\#define \hyperlink{elev_8c_a502c6e1de39b09df67764a508b438faf}{N\-\_\-\-L\-A\-M\-P\-S}~3
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{elev_8c_a97d30b7e2538acf5647515638070fdc5}{elev\-\_\-get\-\_\-floor\-\_\-sensor\-\_\-signal} (void)
\item 
void \hyperlink{elev_8c_aa186c7534ee60c6b5bff35317532dc41}{elev\-\_\-set\-\_\-speed} (int speed)
\item 
int \hyperlink{elev_8c_ab1739733d6d71428b84097de6c523ce6}{elev\-\_\-if\-\_\-emergency} ()
\item 
void \hyperlink{elev_8c_a8590f49cd533698d26231f7273141cc1}{elev\-\_\-toggle\-\_\-stop\-\_\-lamp} ()
\item 
void \hyperlink{elev_8c_a6ce9a34b8677b483b0d8f9dc47b42c40}{elev\-\_\-set\-\_\-door\-\_\-open\-\_\-lamp} (int value)
\item 
void \hyperlink{elev_8c_a85de2a6536b4dd0c83bac19923500740}{elev\-\_\-set\-\_\-stop\-\_\-lamp} (int value)
\item 
void \hyperlink{elev_8c_a6af53dd3ebae3a5791ba345eac84d4be}{elev\-\_\-set\-\_\-floor\-\_\-indicator} (int floor)
\item 
void \hyperlink{elev_8c_a436fb24d0ae312744d416866c89d713d}{elev\-\_\-set\-\_\-button\-\_\-lamp} (\hyperlink{elev_8h_a53b93eadbbde69e00119434663ff7b7a}{elev\-\_\-direction\-\_\-t} lamp, int floor, int value)
\item 
void \hyperlink{elev_8c_ac3cfd147914faed159ed3290d29d5a4f}{elev\-\_\-unregister\-\_\-callback} (\hyperlink{elev_8h_a552adbceb37bababf8244aa4d4efb48c}{elev\-\_\-signal\-\_\-t} type)
\item 
void \hyperlink{elev_8c_a7814fffb1c7cd91d37d8e9ac699de615}{elev\-\_\-register\-\_\-callback} (\hyperlink{elev_8h_a552adbceb37bababf8244aa4d4efb48c}{elev\-\_\-signal\-\_\-t} type, void($\ast$callback)(int, int))
\item 
void \hyperlink{elev_8c_a1c638f89811b7dc27b03c14ded650413}{elev\-\_\-disable\-\_\-callbacks} (int thread)
\item 
int \hyperlink{elev_8c_a949b0e1f7c0f03ea6f92008c378e4573}{elev\-\_\-init} (void)
\item 
int \hyperlink{elev_8c_ad521989ab4c1ba0a24937f22dfdae3b4}{elev\-\_\-enable\-\_\-callbacks} (void)
\item 
void \hyperlink{elev_8c_a4b9c82b159077e807108f3647b0f0b8d}{elev\-\_\-reset\-\_\-all\-\_\-lamps} (void)
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{elev_8c_a78c99ffd76a7bb3c8c74db76207e9ab4}{\index{elev.\-c@{elev.\-c}!\-\_\-\-X\-O\-P\-E\-N\-\_\-\-S\-O\-U\-R\-C\-E@{\-\_\-\-X\-O\-P\-E\-N\-\_\-\-S\-O\-U\-R\-C\-E}}
\index{\-\_\-\-X\-O\-P\-E\-N\-\_\-\-S\-O\-U\-R\-C\-E@{\-\_\-\-X\-O\-P\-E\-N\-\_\-\-S\-O\-U\-R\-C\-E}!elev.c@{elev.\-c}}
\subsubsection[{\-\_\-\-X\-O\-P\-E\-N\-\_\-\-S\-O\-U\-R\-C\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define \-\_\-\-X\-O\-P\-E\-N\-\_\-\-S\-O\-U\-R\-C\-E~500}}\label{elev_8c_a78c99ffd76a7bb3c8c74db76207e9ab4}
\hypertarget{elev_8c_a502c6e1de39b09df67764a508b438faf}{\index{elev.\-c@{elev.\-c}!N\-\_\-\-L\-A\-M\-P\-S@{N\-\_\-\-L\-A\-M\-P\-S}}
\index{N\-\_\-\-L\-A\-M\-P\-S@{N\-\_\-\-L\-A\-M\-P\-S}!elev.c@{elev.\-c}}
\subsubsection[{N\-\_\-\-L\-A\-M\-P\-S}]{\setlength{\rightskip}{0pt plus 5cm}\#define N\-\_\-\-L\-A\-M\-P\-S~3}}\label{elev_8c_a502c6e1de39b09df67764a508b438faf}
\hypertarget{elev_8c_aea0d2ffe945c5b48aab391a3ac08309b}{\index{elev.\-c@{elev.\-c}!N\-\_\-\-S\-I\-G\-N\-A\-L\-S@{N\-\_\-\-S\-I\-G\-N\-A\-L\-S}}
\index{N\-\_\-\-S\-I\-G\-N\-A\-L\-S@{N\-\_\-\-S\-I\-G\-N\-A\-L\-S}!elev.c@{elev.\-c}}
\subsubsection[{N\-\_\-\-S\-I\-G\-N\-A\-L\-S}]{\setlength{\rightskip}{0pt plus 5cm}\#define N\-\_\-\-S\-I\-G\-N\-A\-L\-S~6}}\label{elev_8c_aea0d2ffe945c5b48aab391a3ac08309b}
\hypertarget{elev_8c_a51f1b5dd58811d0028c967793a515699}{\index{elev.\-c@{elev.\-c}!P\-O\-L\-L\-I\-N\-G\-\_\-\-I\-N\-T\-E\-R\-V\-A\-L@{P\-O\-L\-L\-I\-N\-G\-\_\-\-I\-N\-T\-E\-R\-V\-A\-L}}
\index{P\-O\-L\-L\-I\-N\-G\-\_\-\-I\-N\-T\-E\-R\-V\-A\-L@{P\-O\-L\-L\-I\-N\-G\-\_\-\-I\-N\-T\-E\-R\-V\-A\-L}!elev.c@{elev.\-c}}
\subsubsection[{P\-O\-L\-L\-I\-N\-G\-\_\-\-I\-N\-T\-E\-R\-V\-A\-L}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-L\-L\-I\-N\-G\-\_\-\-I\-N\-T\-E\-R\-V\-A\-L~50000}}\label{elev_8c_a51f1b5dd58811d0028c967793a515699}


\subsection{Function Documentation}
\hypertarget{elev_8c_a1c638f89811b7dc27b03c14ded650413}{\index{elev.\-c@{elev.\-c}!elev\-\_\-disable\-\_\-callbacks@{elev\-\_\-disable\-\_\-callbacks}}
\index{elev\-\_\-disable\-\_\-callbacks@{elev\-\_\-disable\-\_\-callbacks}!elev.c@{elev.\-c}}
\subsubsection[{elev\-\_\-disable\-\_\-callbacks}]{\setlength{\rightskip}{0pt plus 5cm}void elev\-\_\-disable\-\_\-callbacks (
\begin{DoxyParamCaption}
\item[{int}]{thread}
\end{DoxyParamCaption}
)}}\label{elev_8c_a1c638f89811b7dc27b03c14ded650413}
Stops calling callbacks when signals arrive. This function will kill off the thread that polls the elevator for signals. 
\begin{DoxyParams}{Parameters}
{\em thread} & Value returned from corresponding \hyperlink{elev_8c_ad521989ab4c1ba0a24937f22dfdae3b4}{elev\-\_\-enable\-\_\-callbacks()}. \\
\hline
\end{DoxyParams}
\hypertarget{elev_8c_ad521989ab4c1ba0a24937f22dfdae3b4}{\index{elev.\-c@{elev.\-c}!elev\-\_\-enable\-\_\-callbacks@{elev\-\_\-enable\-\_\-callbacks}}
\index{elev\-\_\-enable\-\_\-callbacks@{elev\-\_\-enable\-\_\-callbacks}!elev.c@{elev.\-c}}
\subsubsection[{elev\-\_\-enable\-\_\-callbacks}]{\setlength{\rightskip}{0pt plus 5cm}int elev\-\_\-enable\-\_\-callbacks (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{elev_8c_ad521989ab4c1ba0a24937f22dfdae3b4}
Start calling callbacks when signals arrive. This function spawns a new thread that polls the elevator for signals (like the elevator arriving at a new floor, or a button is pushed), and calls the associated callback functions (if registered). \begin{DoxyReturn}{Returns}
thread index of new thread. Needed to call \hyperlink{elev_8c_a1c638f89811b7dc27b03c14ded650413}{elev\-\_\-disable\-\_\-callbacks()}. 
\end{DoxyReturn}
\hypertarget{elev_8c_a97d30b7e2538acf5647515638070fdc5}{\index{elev.\-c@{elev.\-c}!elev\-\_\-get\-\_\-floor\-\_\-sensor\-\_\-signal@{elev\-\_\-get\-\_\-floor\-\_\-sensor\-\_\-signal}}
\index{elev\-\_\-get\-\_\-floor\-\_\-sensor\-\_\-signal@{elev\-\_\-get\-\_\-floor\-\_\-sensor\-\_\-signal}!elev.c@{elev.\-c}}
\subsubsection[{elev\-\_\-get\-\_\-floor\-\_\-sensor\-\_\-signal}]{\setlength{\rightskip}{0pt plus 5cm}int elev\-\_\-get\-\_\-floor\-\_\-sensor\-\_\-signal (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{elev_8c_a97d30b7e2538acf5647515638070fdc5}
Get floor sensor signal. \begin{DoxyReturn}{Returns}
-\/1 if elevator is not on a floor. 0-\/3 if elevator is on floor. 0 is ground floor, 3 is top floor. 
\end{DoxyReturn}
\hypertarget{elev_8c_ab1739733d6d71428b84097de6c523ce6}{\index{elev.\-c@{elev.\-c}!elev\-\_\-if\-\_\-emergency@{elev\-\_\-if\-\_\-emergency}}
\index{elev\-\_\-if\-\_\-emergency@{elev\-\_\-if\-\_\-emergency}!elev.c@{elev.\-c}}
\subsubsection[{elev\-\_\-if\-\_\-emergency}]{\setlength{\rightskip}{0pt plus 5cm}int elev\-\_\-if\-\_\-emergency (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{elev_8c_ab1739733d6d71428b84097de6c523ce6}
\hypertarget{elev_8c_a949b0e1f7c0f03ea6f92008c378e4573}{\index{elev.\-c@{elev.\-c}!elev\-\_\-init@{elev\-\_\-init}}
\index{elev\-\_\-init@{elev\-\_\-init}!elev.c@{elev.\-c}}
\subsubsection[{elev\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}int elev\-\_\-init (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{elev_8c_a949b0e1f7c0f03ea6f92008c378e4573}
Initialize elevator. \begin{DoxyReturn}{Returns}
Non-\/zero on success, 0 on failure. 
\end{DoxyReturn}
\hypertarget{elev_8c_a7814fffb1c7cd91d37d8e9ac699de615}{\index{elev.\-c@{elev.\-c}!elev\-\_\-register\-\_\-callback@{elev\-\_\-register\-\_\-callback}}
\index{elev\-\_\-register\-\_\-callback@{elev\-\_\-register\-\_\-callback}!elev.c@{elev.\-c}}
\subsubsection[{elev\-\_\-register\-\_\-callback}]{\setlength{\rightskip}{0pt plus 5cm}void elev\-\_\-register\-\_\-callback (
\begin{DoxyParamCaption}
\item[{{\bf elev\-\_\-signal\-\_\-t}}]{type, }
\item[{void($\ast$)(int, int)}]{callback}
\end{DoxyParamCaption}
)}}\label{elev_8c_a7814fffb1c7cd91d37d8e9ac699de615}
Register a callback function to handle signals from the elevator. 
\begin{DoxyParams}{Parameters}
{\em type} & Type of signal to register handler for. \\
\hline
{\em Callback} & function to call when signal arrives. The callback function must be on the following form\-: `void fun(int floor, int value)'. S\-I\-G\-N\-A\-L\-\_\-\-T\-Y\-P\-E\-\_\-\-S\-T\-O\-P triggers on pushing the stop button, `floor' and `value' is always passed 0. S\-I\-G\-N\-A\-L\-\_\-\-T\-Y\-P\-E\-\_\-\-O\-B\-S\-T\-R triggers on flipping the obstruction switch. `floor' is always passed 0. `value' is one for obstruction enabled, 0 for disabled. S\-I\-G\-N\-A\-L\-\_\-\-T\-Y\-P\-E\-\_\-\-S\-E\-N\-S\-O\-R triggers on both entering and leaving a floor. `floor' is the number of the floor, `value' is 1 for entering the floor, 0 for leaving. S\-I\-G\-N\-A\-L\-\_\-\-T\-Y\-P\-E\-\_\-\-C\-A\-L\-L\-\_\-\-U\-P, S\-I\-G\-N\-A\-L\-\_\-\-T\-Y\-P\-E\-\_\-\-C\-A\-L\-L\-\_\-\-D\-O\-W\-N, S\-I\-G\-N\-A\-L\-\_\-\-T\-Y\-P\-E\-\_\-\-C\-O\-M\-M\-A\-N\-D triggers on button push. The command buttons are the floor buttons \char`\"{}inside\char`\"{} the elevator. `floor' is the floor of the button being pushed, `value' is the type of button, according to elev\-\_\-direction\-\_\-t, defined above (E\-L\-E\-V\-\_\-\-D\-I\-R\-\_\-\-D\-O\-W\-N etc.). \\
\hline
\end{DoxyParams}
\hypertarget{elev_8c_a4b9c82b159077e807108f3647b0f0b8d}{\index{elev.\-c@{elev.\-c}!elev\-\_\-reset\-\_\-all\-\_\-lamps@{elev\-\_\-reset\-\_\-all\-\_\-lamps}}
\index{elev\-\_\-reset\-\_\-all\-\_\-lamps@{elev\-\_\-reset\-\_\-all\-\_\-lamps}!elev.c@{elev.\-c}}
\subsubsection[{elev\-\_\-reset\-\_\-all\-\_\-lamps}]{\setlength{\rightskip}{0pt plus 5cm}void elev\-\_\-reset\-\_\-all\-\_\-lamps (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{elev_8c_a4b9c82b159077e807108f3647b0f0b8d}
Clears all lamps. Clears all lamps. Useful on reset, as lamps from previous runs may still be lit. \hypertarget{elev_8c_a436fb24d0ae312744d416866c89d713d}{\index{elev.\-c@{elev.\-c}!elev\-\_\-set\-\_\-button\-\_\-lamp@{elev\-\_\-set\-\_\-button\-\_\-lamp}}
\index{elev\-\_\-set\-\_\-button\-\_\-lamp@{elev\-\_\-set\-\_\-button\-\_\-lamp}!elev.c@{elev.\-c}}
\subsubsection[{elev\-\_\-set\-\_\-button\-\_\-lamp}]{\setlength{\rightskip}{0pt plus 5cm}void elev\-\_\-set\-\_\-button\-\_\-lamp (
\begin{DoxyParamCaption}
\item[{{\bf elev\-\_\-direction\-\_\-t}}]{lamp, }
\item[{int}]{floor, }
\item[{int}]{value}
\end{DoxyParamCaption}
)}}\label{elev_8c_a436fb24d0ae312744d416866c89d713d}
Set a button lamp. 
\begin{DoxyParams}{Parameters}
{\em lamp} & Which type of lamp to set (call up, call down, or \char`\"{}inside\char`\"{} command). \\
\hline
{\em floor} & Floor of lamp to set. \\
\hline
{\em value} & Non-\/zero value turns lamp on, 0 turns lamp off. \\
\hline
\end{DoxyParams}
\hypertarget{elev_8c_a6ce9a34b8677b483b0d8f9dc47b42c40}{\index{elev.\-c@{elev.\-c}!elev\-\_\-set\-\_\-door\-\_\-open\-\_\-lamp@{elev\-\_\-set\-\_\-door\-\_\-open\-\_\-lamp}}
\index{elev\-\_\-set\-\_\-door\-\_\-open\-\_\-lamp@{elev\-\_\-set\-\_\-door\-\_\-open\-\_\-lamp}!elev.c@{elev.\-c}}
\subsubsection[{elev\-\_\-set\-\_\-door\-\_\-open\-\_\-lamp}]{\setlength{\rightskip}{0pt plus 5cm}void elev\-\_\-set\-\_\-door\-\_\-open\-\_\-lamp (
\begin{DoxyParamCaption}
\item[{int}]{value}
\end{DoxyParamCaption}
)}}\label{elev_8c_a6ce9a34b8677b483b0d8f9dc47b42c40}
Turn door-\/open lamp on or off. 
\begin{DoxyParams}{Parameters}
{\em value} & Non-\/zero value turns lamp on, 0 turns lamp off. \\
\hline
\end{DoxyParams}
\hypertarget{elev_8c_a6af53dd3ebae3a5791ba345eac84d4be}{\index{elev.\-c@{elev.\-c}!elev\-\_\-set\-\_\-floor\-\_\-indicator@{elev\-\_\-set\-\_\-floor\-\_\-indicator}}
\index{elev\-\_\-set\-\_\-floor\-\_\-indicator@{elev\-\_\-set\-\_\-floor\-\_\-indicator}!elev.c@{elev.\-c}}
\subsubsection[{elev\-\_\-set\-\_\-floor\-\_\-indicator}]{\setlength{\rightskip}{0pt plus 5cm}void elev\-\_\-set\-\_\-floor\-\_\-indicator (
\begin{DoxyParamCaption}
\item[{int}]{floor}
\end{DoxyParamCaption}
)}}\label{elev_8c_a6af53dd3ebae3a5791ba345eac84d4be}
Set floor indicator lamp for a given floor. 
\begin{DoxyParams}{Parameters}
{\em floor} & Which floor lamp to turn on. Other floor lamps are turned off. \\
\hline
\end{DoxyParams}
\hypertarget{elev_8c_aa186c7534ee60c6b5bff35317532dc41}{\index{elev.\-c@{elev.\-c}!elev\-\_\-set\-\_\-speed@{elev\-\_\-set\-\_\-speed}}
\index{elev\-\_\-set\-\_\-speed@{elev\-\_\-set\-\_\-speed}!elev.c@{elev.\-c}}
\subsubsection[{elev\-\_\-set\-\_\-speed}]{\setlength{\rightskip}{0pt plus 5cm}void elev\-\_\-set\-\_\-speed (
\begin{DoxyParamCaption}
\item[{int}]{speed}
\end{DoxyParamCaption}
)}}\label{elev_8c_aa186c7534ee60c6b5bff35317532dc41}
Sets the speed of the elevator. 
\begin{DoxyParams}{Parameters}
{\em speed} & New speed of elevator. Positive values denote upward movement and vice versa. Set speed to 0 to stop the elevator. \\
\hline
\end{DoxyParams}
\hypertarget{elev_8c_a85de2a6536b4dd0c83bac19923500740}{\index{elev.\-c@{elev.\-c}!elev\-\_\-set\-\_\-stop\-\_\-lamp@{elev\-\_\-set\-\_\-stop\-\_\-lamp}}
\index{elev\-\_\-set\-\_\-stop\-\_\-lamp@{elev\-\_\-set\-\_\-stop\-\_\-lamp}!elev.c@{elev.\-c}}
\subsubsection[{elev\-\_\-set\-\_\-stop\-\_\-lamp}]{\setlength{\rightskip}{0pt plus 5cm}void elev\-\_\-set\-\_\-stop\-\_\-lamp (
\begin{DoxyParamCaption}
\item[{int}]{value}
\end{DoxyParamCaption}
)}}\label{elev_8c_a85de2a6536b4dd0c83bac19923500740}
Turn stop lamp on or off. 
\begin{DoxyParams}{Parameters}
{\em value} & Non-\/zero value turns lamp on, 0 turns lamp off. \\
\hline
\end{DoxyParams}
\hypertarget{elev_8c_a8590f49cd533698d26231f7273141cc1}{\index{elev.\-c@{elev.\-c}!elev\-\_\-toggle\-\_\-stop\-\_\-lamp@{elev\-\_\-toggle\-\_\-stop\-\_\-lamp}}
\index{elev\-\_\-toggle\-\_\-stop\-\_\-lamp@{elev\-\_\-toggle\-\_\-stop\-\_\-lamp}!elev.c@{elev.\-c}}
\subsubsection[{elev\-\_\-toggle\-\_\-stop\-\_\-lamp}]{\setlength{\rightskip}{0pt plus 5cm}void elev\-\_\-toggle\-\_\-stop\-\_\-lamp (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{elev_8c_a8590f49cd533698d26231f7273141cc1}
Toggle the stop light to turn on and off every other time. \hypertarget{elev_8c_ac3cfd147914faed159ed3290d29d5a4f}{\index{elev.\-c@{elev.\-c}!elev\-\_\-unregister\-\_\-callback@{elev\-\_\-unregister\-\_\-callback}}
\index{elev\-\_\-unregister\-\_\-callback@{elev\-\_\-unregister\-\_\-callback}!elev.c@{elev.\-c}}
\subsubsection[{elev\-\_\-unregister\-\_\-callback}]{\setlength{\rightskip}{0pt plus 5cm}void elev\-\_\-unregister\-\_\-callback (
\begin{DoxyParamCaption}
\item[{{\bf elev\-\_\-signal\-\_\-t}}]{type}
\end{DoxyParamCaption}
)}}\label{elev_8c_ac3cfd147914faed159ed3290d29d5a4f}
Remove an association from a callback function. After calling this function, callback will not be called when the associated signal arrives. 
\begin{DoxyParams}{Parameters}
{\em type} & Type of signal to register handler for. \\
\hline
\end{DoxyParams}
